{% extends 'base.html' %}
{% block content %}

<h2 id="man_chores">Hi {{ user.user_name}} </h2>

<h2 id="manchores">These are your chores for today</h2>
{% if userchores_mans %} 

<form id= "status" action='/process-chores' method="POST">
    {% for userchore_man in userchores_mans %}
        <li id="{{userchore_man.chore_id}}" style="list-style-type:none"> 
                
        <button  id="{{userchore_man.id}}" class ="man saverbutton" data-choreid= "{{userchore_man.chore_id}}"  
        value="done" style="backgroung:blue">done</button> 
                  {{ userchore_man.chore.description }} 
        </li>
    {% endfor %}
    {% else %}
     

{% endif %}
<h2 id="volchores"> You can get rewards for this chores</h2>
{% if userchores_vols %} 

    {% for userchore_vol in userchores_vols %}
        <li id="{{userchore_vol.chore_id}}" style="list-style-type:none"> 
            
                
            <button id="{{userchore_vol.id}}" class ="vol saverbutton" data-choreid= "{{userchore_vol.chore_id}}" 
                    data-reward="{{userchore_vol.chore.reward }}"  value="done" >done</button> 
                    {{ userchore_vol.chore.description }} :{{userchore_vol.chore.reward}}$
        </li>
    {% endfor %}

{% endif %}

   
</form>
   
{% if userchore_diary %}
    <li id="diary" style="list-style-type:none">  
        <a href= "/user/diary" >Write in my diary</a>
    </li>   
 {% endif %}


{% if "balance" in session %}
<div id="user-balance">
<h4  >Your balnace is: <b id="show_balnace"> {{ session["balance"] }}</b> 
    dollars! <button id="redeem" type="button" class="btn btn-light" style="color:blue"> Reedem</button>  </h4>
</div>
<h3 id="after_send"></h3>
 {% else %}
 <a href='/show-balance'> Show me my balnace</a>
 {% endif %}
 <br>

<script>
function showsendResults(results) {
        console.log(results.status);
            if (results.status==='ok') {
                $("#after_send").html("A request to reedem your balance was sent to mom");
            
            };
}


function requestreedem(evt) {
    $.get('/send', showsendResults);
}

 $("#redeem").on("click", requestreedem);
</script>


   <script type="text/javascript">
   
        function showUpdateResults(results) {
            if (results.status==='ok') {
                let chore_id = results.chore;
                console.log(results.last);
                console.log(chore_id);
                let item = document.getElementById(chore_id);
                console.log(item.status);
                console.dir(item.textContent);
                console.log(item.innerHTML);
                // item.prop( "disabled", true );
                item.remove();
                if (results.lastman ==='yes') {
                    document.getElementById("manchores").innerHTML= "Done with must chores! NICE";
                };

                if (results.lastvol ==='yes') {
                    document.getElementById("volchores").innerHTML= "Done with reward chores GREAT JOB!";
                };
                    
            };
            
        }
function UpdateStatus(evt) {
    event.preventDefault()

    let choredata = $(evt.target).data();
    console.log(choredata)
    let choreid = choredata["choreid"];
        
    console.log(choreid);
       
            var formInputs = {
            "choreid": choreid, 
            };

        $.post('/process-chores', formInputs, showUpdateResults);
    
    }
    $(".saverbutton").on("click", UpdateStatus);
    
</script>

<script>

 function new_balance(results) {
            if (results.status==='ok') {
                let new_balance = results.balance;
                let old_balance = document.getElementById("show_balnace");
                old_balance.innerHTML =new_balance;
            };

        };

function updatebalance(evt) {
    event.preventDefault()

    let rewarddata = $(evt.target).data();
    let reward = rewarddata["reward"];
        
    console.log(reward);
       
            var formInputs = {
            "reward": reward
            };

        $.post('/update-session-balance', formInputs, new_balance);
    
    }

$(".vol").on("click", updatebalance);

</script>
<br>
<br>
<br>
{% endblock %}
