{% extends 'base.html' %}
{% block content %}



<div class="container">
    <div class="row">
        <div class="col-12">
       <h2 id="man_chores">Hi {{ user.user_name}} </h2>
   </div>
    </div>
    <div class="row">
        <div class="col-12">
            {% if userchores_mans %} 
        <h2 id="manchores">These are your chores for today</h2>
         {% else %}
    <h2 id="manchores">Great job today </h2>
    {% endif %}
    </div>
    </div>
<form id= "status" action='/process-chores' method="POST">
    {% for userchore_man in userchores_mans %}
    <div id="{{userchore_man.chore_id}}" class="row">
    <div class="col-6" >
        <li  style="list-style-type:none"> 
                {{ userchore_man.chore.description }} 
            </div>
    <div class="col-6">
        <button class ="man saverbutton" data-choreid= "{{userchore_man.chore_id}}"  
        value="done" style="backgroung:blue">done</button> 
                  
        </li>
    </div>
</div>
    {% endfor %}


{% if userchores_vols %}    
<h2 id="volchores"> You can get rewards for this chores</h2>
    {% for userchore_vol in userchores_vols %}
    <div id="{{userchore_vol.chore_id}}" class="row">
    <div class="col-6" >
        <li style="list-style-type:none"> 
       
                {{ userchore_vol.chore.description }} :{{userchore_vol.chore.reward}}$
         </div>    
       <div class="col-6" >
            <button class ="vol saverbutton" data-choreid= "{{userchore_vol.chore_id}}" 
                    data-reward="{{userchore_vol.chore.reward }}"  value="done" >done</button> 
                    
        </li>
    </div>
</div>

{% endfor %}
{% else %}

{% endif %}

   </form>
<div class="row"> 
    <div class="col-12">
{% if userchore_diary %}
  <div class="row">
    <div class="col-12">
    <li id="diary" style="list-style-type:none">  
        <a href= "/user/diary" >Write in my diary</a>
    </li>   
    </div>
</div>
 {% endif %}
</div>
</div>

{% if "balance" in session %}
<div id="user-balance" class="row">
    <div class="col-12">

<h4  >Your balnace is: <b id="show_balnace"> {{ session["balance"] }}</b> 
    dollars! <button id="redeem" type="button" class="btn btn-light" style="color:blue"> Reedem</button> 
</h4>
</div>
</div>
<h3 id="after_send"></h3>
 {% else %}
 <a href='/show-balance'> Show me my balnace</a>
 {% endif %}
 <br>


</div>
</div>
<script>
function showsendResults(results) {
        console.log(results.status);
            if (results.status==='ok') {
                $("#after_send").html("A request to reedem your balance was sent to mom");
            
            };
}


function requestreedem(evt) {
    $.get('/send', showsendResults);
}

 $("#redeem").on("click", requestreedem);
</script>


   <script type="text/javascript">
   
        function showUpdateResults(results) {
            if (results.status==='ok') {
                let chore_id = results.chore;
                console.log(results.last);
                console.log(chore_id);
                let item = document.getElementById(chore_id);
                console.log(item.status);
                console.dir(item.textContent);
                console.log(item.innerHTML);
                // item.prop( "disabled", true );
                item.remove();
                if (results.lastman ==='yes') {
                    document.getElementById("manchores").innerHTML= "Great job. You are done ";
                };

                if (results.lastvol ==='yes') {
                    document.getElementById("volchores").innerHTML= "Great  job!";
                };
                    
            };
            
        }
function UpdateStatus(evt) {
    event.preventDefault()

    let choredata = $(evt.target).data();
    console.log(choredata)
    let choreid = choredata["choreid"];
        
    console.log(choreid);
       
            var formInputs = {
            "choreid": choreid, 
            };

        $.post('/process-chores', formInputs, showUpdateResults);
    
    }
    $(".saverbutton").on("click", UpdateStatus);
    
</script>

<script>

 function new_balance(results) {
            if (results.status==='ok') {
                let new_balance = results.balance;
                let old_balance = document.getElementById("show_balnace");
                old_balance.innerHTML =new_balance;
            };

        };

function updatebalance(evt) {
    event.preventDefault()

    let rewarddata = $(evt.target).data();
    let reward = rewarddata["reward"];
        
    console.log(reward);
       
            var formInputs = {
            "reward": reward
            };

        $.post('/update-session-balance', formInputs, new_balance);
    
    }

$(".vol").on("click", updatebalance);

</script>
<br>
<br>
<br>
{% endblock %}
